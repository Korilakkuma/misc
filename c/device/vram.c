#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define ROW    3
#define COLUMN 4

// display is 4 : 3
static char VRAM[ROW * COLUMN] = {
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20
};

static const char CG[] = {
  0x00, 0x7e, 0x42, 0x02, 0x7e, 0x42, 0x7e, 0x00,  // a
  0x00, 0x40, 0x40, 0x7c, 0x42, 0x42, 0x7c, 0x00,  // b
  0x00, 0x3c, 0x42, 0x40, 0x40, 0x42, 0x3c, 0x00,  // c
  0x00, 0x02, 0x02, 0x3e, 0x42, 0x42, 0x3e, 0x00,  // d
  0x00, 0x3c, 0x42, 0x7e, 0x40, 0x42, 0x3c, 0x00,  // e
  0x00, 0x0c, 0x12, 0x10, 0x7e, 0x10, 0x10, 0x00,  // f
  0x00, 0x3c, 0x42, 0x3e, 0x02, 0x42, 0x3c, 0x00,  // g
  0x00, 0x40, 0x40, 0x7c, 0x42, 0x42, 0x42, 0x00,  // h
  0x00, 0x10, 0x00, 0x10, 0x10, 0x10, 0x10, 0x00,  // i
  0x00, 0x04, 0x00, 0x04, 0x04, 0x44, 0x38, 0x00,  // j
  0x00, 0x44, 0x48, 0x50, 0x70, 0x48, 0x44, 0x00,  // k
  0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00,  // l
  0x00, 0x54, 0x6a, 0x4a, 0x4a, 0x48, 0x44, 0x00,  // m
  0x00, 0x58, 0x64, 0x44, 0x44, 0x44, 0x44, 0x00,  // n
  0x00, 0x3c, 0x42, 0x42, 0x42, 0x42, 0x3c, 0x00,  // o
  0x00, 0x7c, 0x42, 0x42, 0x7c, 0x40, 0x40, 0x00,  // p
  0x00, 0x1e, 0x22, 0x22, 0x1e, 0x02, 0x7c, 0x00,  // q
  0x00, 0x58, 0x64, 0x44, 0x40, 0x40, 0x40, 0x00,  // r
  0x00, 0x3c, 0x42, 0x40, 0x3c, 0x02, 0x7c, 0x00,  // s
  0x00, 0x10, 0x7c, 0x10, 0x10, 0x10, 0x1c, 0x00,  // t
  0x00, 0x42, 0x42, 0x42, 0x42, 0x46, 0x3a, 0x00,  // u
  0x00, 0x44, 0x44, 0x44, 0x44, 0x28, 0x10, 0x00,  // v
  0x00, 0x52, 0x52, 0x52, 0x52, 0x28, 0x10, 0x00,  // w
  0x00, 0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x00,  // x
  0x00, 0x42, 0x42, 0x3c, 0x08, 0x10, 0x20, 0x00,  // y
  0x00, 0x7e, 0x04, 0x08, 0x10, 0x20, 0x6e, 0x00,  // z
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   // ' ' (space)
};

int main(int argc, char **argv) {
  if (argc != 2) {
    fputs("./vram [a-z ]+\n", stderr);
    exit(EXIT_FAILURE);
  }

  char *s = argv[1];

  strncpy((char *)VRAM, s, (strlen(s) + 1));

  for (int row = 0; row < ROW; row++) {
    for (int display_row = 0; display_row < 8; display_row++) {
      for (int column = 0; column < COLUMN; column++) {
        char ch = VRAM[(row * 4) + column];

        int address;

        if ((ch >= 'a') && (ch <= 'z')) {
          address = ((ch - 'a') * 8) + display_row;
        } else {
          address = 208 + display_row;
        }

        int mask = 0x80;

        for (int display_column = 0; display_column < 8; display_column++) {
          if ((CG[address] & mask) != 0) {
            fputs("*", stdout);
          } else {
            fputs("-", stdout);
          }

          fflush(stdout);

          mask >>= 1;

          sleep(1);
        }
      }

      fputs("\n", stdout);
    }
  }

  return 0;
}
